# apiVersion: networking.istio.io/v1alpha3
# kind: Gateway
# metadata:
#   name: grafana-gateway
#   namespace: istio-system # Use same namespace with backend service
# spec:
#   selector:
#     istio: ingressgateway # use Istio default gateway implementation
#   servers:
#     - port:
#         number: 80
#         name: HTTP
#         protocol: HTTP
#       hosts:
#         - "grafana.xcv.my.id"
# ---
# apiVersion: networking.istio.io/v1alpha3
# kind: VirtualService
# metadata:
#   name: grafana
#   namespace: istio-system # Use same namespace with backend service
# spec:
#   hosts:
#     - "grafana.xcv.my.id"
#   gateways:
#     - grafana-gateway # define gateway name
#   http:
#     - match:
#         - uri:
#             prefix: "/"
#       route:
#         - destination:
#             port:
#               number: 3000 # Backend service port
#             host: grafana # Backend service name
# ---
apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  name: istio
  namespace: istio-system
spec:
  controller: istio.io/ingress-controller
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress
  namespace: istio-system
spec:
  ingressClassName: istio
  rules:
    - host: grafana.xcv.my.id
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: grafana
                port:
                  number: 3000
